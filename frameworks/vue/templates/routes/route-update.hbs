import ApiHttpMethod from "@/api/enums/api_http_method_enum";
import ApiError from "@/api/errors/ApiError";
import { {{pascalCase resource}}Interface } from "../interfaces/{{snakeCase resource}}_interface";
import { {{pascalCase resource}}UpdateInterface } from "../interfaces/{{snakeCase resource}}_update_interface";
import { {{pascalCase resource}}Model } from "../models/{{snakeCase resource}}_model";
import { {{pascalCase resource}}Route } from "./{{snakeCase resource}}_route";
import { {{pascalCase resource}}Store } from "../store";
import NotFoundApiError from "@/api/errors/NotFoundApiError";

/**
 * Route de mise à jour {{pascalCase resource}}
 */
export class {{pascalCase resource}}UpdateRoute extends {{pascalCase resource}}Route {
	constructor(
		private elementId: {{pascalCase resource}}Interface["id"],
		public data: {{pascalCase resource}}UpdateInterface
	) {
		super("/" + {{pascalCase resource}}Route.name + "/" + elementId, ApiHttpMethod.PUT, data);
	}

	async request() {
		if (this.isMock) {
			return this.mock();
		}

		const response = await super.request();
		if (response instanceof ApiError) return response;

		return new {{pascalCase resource}}Model(response as {{pascalCase resource}}Interface);
	}

	async mock() {
		const store: {{pascalCase resource}}Store = await this.store;
		const {{camelCase resource}}ToUpdate = store.find(this.elementId);

		if (!{{camelCase resource}}ToUpdate) {
			return new NotFoundApiError({
				message: `Aucun {{lowerCase resource}} trouvé avec l'ID ${this.elementId}.`,
			});
		}

		const {{camelCase resource}}Updated = new {{pascalCase resource}}Model({
			...{{camelCase resource}}ToUpdate,
			...this.data,
			updated_at: new Date().toISOString(),
		});

		store.update(this.elementId, {{camelCase resource}}Updated.interface);
		return {{camelCase resource}}Updated;
	}
}
