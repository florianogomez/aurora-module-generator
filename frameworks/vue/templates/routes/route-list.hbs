import ApiHttpMethod from "@/api/enums/api_http_method_enum";
import ApiError from "@/api/errors/ApiError";
import { {{pascalCase resource}}Interface } from "../interfaces/{{snakeCase resource}}_interface";
import { {{pascalCase resource}}Model } from "../models/{{snakeCase resource}}_model";
import { {{pascalCase resource}}Route } from "./{{snakeCase resource}}_route";
import { {{pascalCase resource}}Store } from "../store";
import { {{pascalCase resource}}ListFilterInterface } from "../interfaces/{{snakeCase resource}}_list_filter_interface";

/**
 * Route de liste {{pascalCase resource}}
 */
export class {{pascalCase resource}}ListRoute extends {{pascalCase resource}}Route {
	constructor(private filters: {{pascalCase resource}}ListFilterInterface = {}) {
		super(`/${{{pascalCase resource}}Route.name}`, ApiHttpMethod.GET, filters);
	}

	async request() {
		if (this.isMock) {
			return this.mock();
		}

		const response = await super.request();
		if (response instanceof ApiError) return response;

		return (response as {{pascalCase resource}}Interface[]).map((data) => new {{pascalCase resource}}Model(data));
	}

	async mock() {
		const store: {{pascalCase resource}}Store = await this.store;
		const results = store.elements.map((e) => new {{pascalCase resource}}Model(e));

		return results;
	}
}
