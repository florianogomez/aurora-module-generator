import ApiHttpMethod from "@/api/enums/api_http_method_enum";
import ApiError from "@/api/errors/ApiError";
import { {{pascalCase resource}}Interface } from "../interfaces/{{snakeCase resource}}_interface";
import { {{pascalCase resource}}Model } from "../models/{{snakeCase resource}}_model";
import { {{pascalCase resource}}Route } from "./{{snakeCase resource}}_route";
import { {{pascalCase resource}}Store } from "../store";
import NotFoundApiError from "@/api/errors/NotFoundApiError";

/**
 * Route de suppression {{pascalCase resource}}
 */
export class {{pascalCase resource}}DeleteRoute extends {{pascalCase resource}}Route {
	constructor(private elementId: {{pascalCase resource}}Interface["id"]) {
		super(`/${{{pascalCase resource}}Route.name}/${elementId}`, ApiHttpMethod.DELETE, { elementId });
	}

	async request() {
		if (this.isMock) {
			return this.mock();
		}

		const response = await super.request();
		if (response instanceof ApiError) return response;

		return new {{pascalCase resource}}Model(response as {{pascalCase resource}}Interface);
	}

	async mock() {
		const store: {{pascalCase resource}}Store = await this.store;
		const {{camelCase resource}}ToDelete = store.find(this.elementId);

		if (!{{camelCase resource}}ToDelete) {
			return new NotFoundApiError({
				message: `Aucun {{lowerCase resource}} trouv√© avec l'ID ${this.elementId}.`,
			});
		}

		store.remove(this.elementId);
		return new {{pascalCase resource}}Model({{camelCase resource}}ToDelete);
	}
}
