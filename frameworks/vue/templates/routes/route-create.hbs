import ApiHttpMethod from "@/api/enums/api_http_method_enum";
import ApiError from "@/api/errors/ApiError";
import { {{pascalCase resource}}Interface } from "../interfaces/{{snakeCase resource}}_interface";
import { {{pascalCase resource}}CreateInterface } from "../interfaces/{{snakeCase resource}}_create_interface";
import { {{pascalCase resource}}Model } from "../models/{{snakeCase resource}}_model";
import { {{pascalCase resource}}Route } from "./{{snakeCase resource}}_route";
import { faker } from "@faker-js/faker";
import { {{pascalCase resource}}Store } from "../store";

/**
 * Route de cr√©ation {{pascalCase resource}}
 */
export class {{pascalCase resource}}CreateRoute extends {{pascalCase resource}}Route {
	constructor(public data: {{pascalCase resource}}CreateInterface) {
		super("/" + {{pascalCase resource}}Route.name, ApiHttpMethod.POST, data);
	}

	async request() {
		if (this.isMock) {
			return this.mock();
		}

		const response = await super.request();
		if (response instanceof ApiError) return response;

		return new {{pascalCase resource}}Model(response as {{pascalCase resource}}Interface);
	}

	async mock() {
		const store: {{pascalCase resource}}Store = await this.store;
		const model = new {{pascalCase resource}}Model({
			...this.data,
			id: faker.string.uuid(),
			created_at: new Date().toISOString(),
			updated_at: new Date().toISOString(),
		});

		store.add(model.interface);
		return model;
	}
}
